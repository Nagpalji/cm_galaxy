{"ast":null,"code":"import { geometry as g } from '@progress/kendo-drawing';\nimport { addClass, setDefaultOptions, valueOrDefault, defined, mousewheelDelta, limitValue, deepExtend, elementOffset, isArray, round } from '../common';\nimport { EPSG3857 } from './crs';\nimport { Attribution } from './attribution';\nimport { Navigator } from './navigator';\nimport { ZoomControl } from './zoom';\nimport { Location } from './location';\nimport { Extent } from './extent';\nimport { Tooltip } from './tooltip/tooltip';\nimport { TileLayer } from './layers/tile';\nimport { BubbleLayer } from './layers/bubble';\nimport { ShapeLayer } from './layers/shape';\nimport { MarkerLayer } from './layers/marker';\nimport { removeChildren, setDefaultEvents, toHyphens, proxy, now, on, off, getSupportedFeatures, convertToHtml } from './utils';\nimport { Scroller } from './scroller/scroller';\nimport { Observable } from './scroller/observable';\nimport MapService from './../services/map-service';\nimport { CENTER_CHANGE, INIT, ZOOM_CHANGE } from './constants';\nvar math = Math,\n    min = math.min,\n    pow = math.pow,\n    Point = g.Point,\n    MARKER = \"marker\",\n    LOCATION = \"location\",\n    FRICTION = 0.9,\n    FRICTION_MOBILE = 0.93,\n    MOUSEWHEEL = 'DOMMouseScroll mousewheel',\n    VELOCITY_MULTIPLIER = 5,\n    DEFAULT_ZOOM_RATE = 1;\nvar layersMap = {\n  bubble: BubbleLayer,\n  shape: ShapeLayer,\n  tile: TileLayer\n};\nlayersMap[MARKER] = MarkerLayer;\n\nfunction renderPos(pos) {\n  var result = [];\n\n  if (pos) {\n    var parts = toHyphens(pos).split(\"-\");\n\n    for (var i = 0; i < parts.length; i++) {\n      result.push(\"k-pos-\" + parts[i]);\n    }\n  }\n\n  return result.join(\" \");\n}\n\nvar Map = function (Observable) {\n  function Map(element, options, themeOptions, context) {\n    if (options === void 0) options = {};\n    if (themeOptions === void 0) themeOptions = {};\n    if (context === void 0) context = {};\n    Observable.call(this);\n\n    this._init(element, options, themeOptions, context);\n  }\n\n  if (Observable) Map.__proto__ = Observable;\n  Map.prototype = Object.create(Observable && Observable.prototype);\n  Map.prototype.constructor = Map;\n\n  Map.prototype.destroy = function destroy() {\n    var this$1 = this;\n    this.scroller.destroy();\n\n    if (this._tooltip) {\n      this._tooltip.destroy();\n    }\n\n    if (this.navigator) {\n      this.navigator.destroy();\n    }\n\n    if (this.attribution) {\n      this.attribution.destroy();\n    }\n\n    if (this.zoomControl) {\n      this.zoomControl.destroy();\n    }\n\n    if (isArray(this.markers)) {\n      this.markers.forEach(function (markerLayer) {\n        markerLayer.destroy();\n      });\n    } else {\n      this.markers.destroy();\n    }\n\n    for (var i = 0; i < this.layers.length; i++) {\n      this$1.layers[i].destroy();\n    }\n\n    off(this.element, MOUSEWHEEL, this._mousewheelHandler);\n    Observable.prototype.destroy.call(this);\n  };\n\n  Map.prototype._init = function _init(element, options, themeOptions, context) {\n    if (options === void 0) options = {};\n    if (themeOptions === void 0) themeOptions = {};\n    if (context === void 0) context = {};\n    this.support = getSupportedFeatures();\n    this.context = context;\n    this.initObserver(context);\n    this.initServices(context);\n\n    this._notifyObserver(INIT);\n\n    this._initOptions(options);\n\n    this._setEvents(options);\n\n    this.crs = new EPSG3857();\n\n    this._initElement(element);\n\n    this._viewOrigin = this._getOrigin();\n    this._tooltip = this._createTooltip();\n\n    this._initScroller();\n\n    this._initMarkers();\n\n    this._initControls();\n\n    this._initLayers();\n\n    this._reset();\n\n    this._mousewheelHandler = this._mousewheel.bind(this);\n    on(this.element, MOUSEWHEEL, this._mousewheelHandler);\n  };\n\n  Map.prototype._initOptions = function _initOptions(options) {\n    this.options = deepExtend({}, this.options, options);\n  };\n\n  Map.prototype._initElement = function _initElement(element) {\n    this.element = element;\n    addClass(element, \"k-map\");\n    element.style.position = \"relative\";\n    element.setAttribute(\"data-role\", \"map\");\n    removeChildren(element);\n    var div = convertToHtml(\"<div />\");\n    this.element.appendChild(div);\n  };\n\n  Map.prototype.initServices = function initServices(context) {\n    if (context === void 0) context = {};\n    this.widgetService = new MapService(this, context);\n  };\n\n  Map.prototype.initObserver = function initObserver(context) {\n    if (context === void 0) context = {};\n    this.observers = [];\n    this.addObserver(context.observer);\n  };\n\n  Map.prototype.addObserver = function addObserver(observer) {\n    if (observer) {\n      this.observers.push(observer);\n    }\n  };\n\n  Map.prototype.removeObserver = function removeObserver(observer) {\n    var index = this.observers.indexOf(observer);\n\n    if (index >= 0) {\n      this.observers.splice(index, 1);\n    }\n  };\n\n  Map.prototype.requiresHandlers = function requiresHandlers(eventNames) {\n    var observers = this.observers;\n\n    for (var idx = 0; idx < observers.length; idx++) {\n      if (observers[idx].requiresHandlers(eventNames)) {\n        return true;\n      }\n    }\n  };\n\n  Map.prototype.trigger = function trigger(name, args) {\n    if (args === void 0) args = {};\n    args.sender = this;\n    var observers = this.observers;\n    var isDefaultPrevented = false;\n\n    for (var idx = 0; idx < observers.length; idx++) {\n      if (observers[idx].trigger(name, args)) {\n        isDefaultPrevented = true;\n      }\n    }\n\n    if (!isDefaultPrevented) {\n      Observable.prototype.trigger.call(this, name, args);\n    }\n\n    return isDefaultPrevented;\n  };\n\n  Map.prototype._notifyObserver = function _notifyObserver(name, args) {\n    if (args === void 0) args = {};\n    args.sender = this;\n    var observers = this.observers;\n    var isDefaultPrevented = false;\n\n    for (var idx = 0; idx < observers.length; idx++) {\n      if (observers[idx].trigger(name, args)) {\n        isDefaultPrevented = true;\n      }\n    }\n\n    return isDefaultPrevented;\n  };\n\n  Map.prototype.zoom = function zoom(level) {\n    var options = this.options;\n    var result;\n\n    if (defined(level)) {\n      var zoomLevel = math.round(limitValue(level, options.minZoom, options.maxZoom));\n\n      if (options.zoom !== zoomLevel) {\n        options.zoom = zoomLevel;\n        this.widgetService.notify(ZOOM_CHANGE, {\n          zoom: options.zoom\n        });\n\n        this._reset();\n      }\n\n      result = this;\n    } else {\n      result = options.zoom;\n    }\n\n    return result;\n  };\n\n  Map.prototype.center = function center(center$1) {\n    var result;\n\n    if (center$1) {\n      var current = Location.create(center$1);\n      var previous = Location.create(this.options.center);\n\n      if (!current.equals(previous)) {\n        this.options.center = current.toArray();\n        this.widgetService.notify(CENTER_CHANGE, {\n          center: this.options.center\n        });\n\n        this._reset();\n      }\n\n      result = this;\n    } else {\n      result = Location.create(this.options.center);\n    }\n\n    return result;\n  };\n\n  Map.prototype.extent = function extent(extent$1) {\n    var result;\n\n    if (extent$1) {\n      this._setExtent(extent$1);\n\n      result = this;\n    } else {\n      result = this._getExtent();\n    }\n\n    return result;\n  };\n\n  Map.prototype.setOptions = function setOptions(options) {\n    if (options === void 0) options = {};\n    var element = this.element;\n    this.destroy();\n    removeChildren(element);\n\n    this._init(element, options, {}, this.context);\n\n    this._reset();\n  };\n\n  Map.prototype.locationToLayer = function locationToLayer(location, zoom) {\n    var clamp = !this.options.wraparound;\n    var locationObject = Location.create(location);\n    return this.crs.toPoint(locationObject, this._layerSize(zoom), clamp);\n  };\n\n  Map.prototype.layerToLocation = function layerToLocation(point, zoom) {\n    var clamp = !this.options.wraparound;\n    var pointObject = Point.create(point);\n    return this.crs.toLocation(pointObject, this._layerSize(zoom), clamp);\n  };\n\n  Map.prototype.locationToView = function locationToView(location) {\n    var locationObject = Location.create(location);\n    var origin = this.locationToLayer(this._viewOrigin);\n    var point = this.locationToLayer(locationObject);\n    return point.translateWith(origin.scale(-1));\n  };\n\n  Map.prototype.viewToLocation = function viewToLocation(point, zoom) {\n    var origin = this.locationToLayer(this._getOrigin(), zoom);\n    var pointObject = Point.create(point);\n    var pointResult = pointObject.clone().translateWith(origin);\n    return this.layerToLocation(pointResult, zoom);\n  };\n\n  Map.prototype.eventOffset = function eventOffset(e) {\n    var x;\n    var y;\n    var offset = elementOffset(this.element);\n\n    if (e.x && e.x[LOCATION] || e.y && e.y[LOCATION]) {\n      x = e.x[LOCATION] - offset.left;\n      y = e.y[LOCATION] - offset.top;\n    } else {\n      var event = e.originalEvent || e;\n      x = valueOrDefault(event.pageX, event.clientX) - offset.left;\n      y = valueOrDefault(event.pageY, event.clientY) - offset.top;\n    }\n\n    var point = new g.Point(x, y);\n    return point;\n  };\n\n  Map.prototype.eventToView = function eventToView(e) {\n    var cursor = this.eventOffset(e);\n    return this.locationToView(this.viewToLocation(cursor));\n  };\n\n  Map.prototype.eventToLayer = function eventToLayer(e) {\n    return this.locationToLayer(this.eventToLocation(e));\n  };\n\n  Map.prototype.eventToLocation = function eventToLocation(e) {\n    var cursor = this.eventOffset(e);\n    return this.viewToLocation(cursor);\n  };\n\n  Map.prototype.viewSize = function viewSize() {\n    var element = this.element;\n\n    var scale = this._layerSize();\n\n    var width = element.clientWidth;\n\n    if (!this.options.wraparound) {\n      width = min(scale, width);\n    }\n\n    return {\n      width: width,\n      height: min(scale, element.clientHeight)\n    };\n  };\n\n  Map.prototype.exportVisual = function exportVisual() {\n    this._reset();\n\n    return false;\n  };\n\n  Map.prototype.hideTooltip = function hideTooltip() {\n    if (this._tooltip) {\n      this._tooltip.hide();\n    }\n  };\n\n  Map.prototype._setOrigin = function _setOrigin(origin, zoom) {\n    var size = this.viewSize(),\n        topLeft;\n    var originLocation = this._origin = Location.create(origin);\n    topLeft = this.locationToLayer(originLocation, zoom);\n    topLeft.x += size.width / 2;\n    topLeft.y += size.height / 2;\n    this.options.center = this.layerToLocation(topLeft, zoom).toArray();\n    this.widgetService.notify(CENTER_CHANGE, {\n      center: this.options.center\n    });\n    return this;\n  };\n\n  Map.prototype._getOrigin = function _getOrigin(invalidate) {\n    var size = this.viewSize(),\n        topLeft;\n\n    if (invalidate || !this._origin) {\n      topLeft = this.locationToLayer(this.center());\n      topLeft.x -= size.width / 2;\n      topLeft.y -= size.height / 2;\n      this._origin = this.layerToLocation(topLeft);\n    }\n\n    return this._origin;\n  };\n\n  Map.prototype._setExtent = function _setExtent(newExtent) {\n    var this$1 = this;\n    var raw = Extent.create(newExtent);\n    var se = raw.se.clone();\n\n    if (this.options.wraparound && se.lng < 0 && newExtent.nw.lng > 0) {\n      se.lng = 180 + (180 + se.lng);\n    }\n\n    var extent = new Extent(raw.nw, se);\n    this.center(extent.center());\n    var width = this.element.clientWidth;\n    var height = this.element.clientHeight;\n    var zoom;\n\n    for (zoom = this.options.maxZoom; zoom >= this.options.minZoom; zoom--) {\n      var topLeft = this$1.locationToLayer(extent.nw, zoom);\n      var bottomRight = this$1.locationToLayer(extent.se, zoom);\n      var layerWidth = math.abs(bottomRight.x - topLeft.x);\n      var layerHeight = math.abs(bottomRight.y - topLeft.y);\n\n      if (layerWidth <= width && layerHeight <= height) {\n        break;\n      }\n    }\n\n    this.zoom(zoom);\n  };\n\n  Map.prototype._getExtent = function _getExtent() {\n    var nw = this._getOrigin();\n\n    var bottomRight = this.locationToLayer(nw);\n    var size = this.viewSize();\n    bottomRight.x += size.width;\n    bottomRight.y += size.height;\n    var se = this.layerToLocation(bottomRight);\n    return new Extent(nw, se);\n  };\n\n  Map.prototype._zoomAround = function _zoomAround(pivot, level) {\n    this._setOrigin(this.layerToLocation(pivot, level), level);\n\n    this.zoom(level);\n  };\n\n  Map.prototype._initControls = function _initControls() {\n    var controls = this.options.controls;\n\n    if (controls.attribution) {\n      this._createAttribution(controls.attribution);\n    }\n\n    if (!this.support.mobileOS) {\n      if (controls.navigator) {\n        this._createNavigator(controls.navigator);\n      }\n\n      if (controls.zoom) {\n        this._createZoomControl(controls.zoom);\n      }\n    }\n  };\n\n  Map.prototype._createControlElement = function _createControlElement(options, defaultPosition) {\n    var pos = options.position || defaultPosition;\n    var posSelector = '.' + renderPos(pos).replace(' ', '.');\n    var wrap = this.element.querySelector('.k-map-controls' + posSelector) || [];\n\n    if (wrap.length === 0) {\n      var div$1 = document.createElement(\"div\");\n      addClass(div$1, 'k-map-controls ' + renderPos(pos));\n      wrap = div$1;\n      this.element.appendChild(wrap);\n    }\n\n    var div = document.createElement(\"div\");\n    wrap.appendChild(div);\n    return div;\n  };\n\n  Map.prototype._createAttribution = function _createAttribution(options) {\n    var element = this._createControlElement(options, 'bottomRight');\n\n    this.attribution = new Attribution(element, options);\n  };\n\n  Map.prototype._createNavigator = function _createNavigator(options) {\n    var element = this._createControlElement(options, 'topLeft');\n\n    var navigator = this.navigator = new Navigator(element, options);\n    this._navigatorPan = this._navigatorPan.bind(this);\n    navigator.bind('pan', this._navigatorPan);\n    this._navigatorCenter = this._navigatorCenter.bind(this);\n    navigator.bind('center', this._navigatorCenter);\n  };\n\n  Map.prototype._navigatorPan = function _navigatorPan(e) {\n    var scroller = this.scroller;\n    var x = scroller.scrollLeft + e.x;\n    var y = scroller.scrollTop - e.y;\n    var bounds = this._virtualSize;\n    var width = this.element.clientWidth;\n    var height = this.element.clientHeight; // TODO: Move limits to scroller\n\n    x = limitValue(x, bounds.x.min, bounds.x.max - width);\n    y = limitValue(y, bounds.y.min, bounds.y.max - height);\n    this.scroller.one('scroll', proxy(this._scrollEnd, this));\n    this.scroller.scrollTo(-x, -y);\n  };\n\n  Map.prototype._navigatorCenter = function _navigatorCenter() {\n    this.center(this.options.center);\n  };\n\n  Map.prototype._createZoomControl = function _createZoomControl(options) {\n    var element = this._createControlElement(options, 'topLeft');\n\n    var zoomControl = this.zoomControl = new ZoomControl(element, options);\n    this._zoomControlChange = this._zoomControlChange.bind(this);\n    zoomControl.bind('change', this._zoomControlChange);\n  };\n\n  Map.prototype._zoomControlChange = function _zoomControlChange(e) {\n    if (!this.trigger('zoomStart', {\n      originalEvent: e\n    })) {\n      this.zoom(this.zoom() + e.delta);\n      this.trigger('zoomEnd', {\n        originalEvent: e\n      });\n    }\n  };\n\n  Map.prototype._initScroller = function _initScroller() {\n    var friction = this.support.mobileOS ? FRICTION_MOBILE : FRICTION;\n    var zoomable = this.options.zoomable !== false;\n    var scroller = this.scroller = new Scroller(this.element.children[0], {\n      friction: friction,\n      velocityMultiplier: VELOCITY_MULTIPLIER,\n      zoom: zoomable,\n      mousewheelScrolling: false,\n      supportDoubleTap: true\n    });\n    scroller.bind('scroll', proxy(this._scroll, this));\n    scroller.bind('scrollEnd', proxy(this._scrollEnd, this));\n    scroller.userEvents.bind('gesturestart', proxy(this._scaleStart, this));\n    scroller.userEvents.bind('gestureend', proxy(this._scale, this));\n    scroller.userEvents.bind('doubleTap', proxy(this._doubleTap, this));\n    scroller.userEvents.bind('tap', proxy(this._tap, this));\n    this.scrollElement = scroller.scrollElement;\n  };\n\n  Map.prototype._initLayers = function _initLayers() {\n    var this$1 = this;\n    var defs = this.options.layers,\n        layers = this.layers = [];\n\n    for (var i = 0; i < defs.length; i++) {\n      var options = defs[i];\n\n      var layer = this$1._createLayer(options);\n\n      layers.push(layer);\n    }\n  };\n\n  Map.prototype._createLayer = function _createLayer(options) {\n    var type = options.type || 'shape';\n    var layerDefaults = this.options.layerDefaults[type];\n    var layerOptions = type === MARKER ? deepExtend({}, this.options.markerDefaults, options) : deepExtend({}, layerDefaults, options);\n    var layerConstructor = layersMap[type];\n    var layer = new layerConstructor(this, layerOptions);\n\n    if (type === MARKER) {\n      this.markers = layer;\n    }\n\n    return layer;\n  };\n\n  Map.prototype._createTooltip = function _createTooltip() {\n    return new Tooltip(this.widgetService, this.options.tooltip);\n  };\n  /* eslint-disable arrow-body-style */\n\n\n  Map.prototype._initMarkers = function _initMarkers() {\n    var markerLayers = (this.options.layers || []).filter(function (x) {\n      return x && x.type === MARKER;\n    });\n\n    if (markerLayers.length > 0) {\n      // render the markers from options.layers\n      // instead of options.markers\n      return;\n    }\n\n    this.markers = new MarkerLayer(this, this.options.markerDefaults);\n    this.markers.add(this.options.markers);\n  };\n  /* eslint-enable arrow-body-style */\n\n\n  Map.prototype._scroll = function _scroll(e) {\n    var origin = this.locationToLayer(this._viewOrigin).round();\n    var movable = e.sender.movable;\n    var offset = new g.Point(movable.x, movable.y).scale(-1).scale(1 / movable.scale);\n    origin.x += offset.x;\n    origin.y += offset.y;\n    this._scrollOffset = offset;\n    this._tooltip.offset = offset;\n    this.hideTooltip();\n\n    this._setOrigin(this.layerToLocation(origin));\n\n    this.trigger('pan', {\n      originalEvent: e,\n      origin: this._getOrigin(),\n      center: this.center()\n    });\n  };\n\n  Map.prototype._scrollEnd = function _scrollEnd(e) {\n    if (!this._scrollOffset || !this._panComplete()) {\n      return;\n    }\n\n    this._scrollOffset = null;\n    this._panEndTimestamp = now();\n    this.trigger('panEnd', {\n      originalEvent: e,\n      origin: this._getOrigin(),\n      center: this.center()\n    });\n  };\n\n  Map.prototype._panComplete = function _panComplete() {\n    return now() - (this._panEndTimestamp || 0) > 50;\n  };\n\n  Map.prototype._scaleStart = function _scaleStart(e) {\n    if (this.trigger('zoomStart', {\n      originalEvent: e\n    })) {\n      var touch = e.touches[1];\n\n      if (touch) {\n        touch.cancel();\n      }\n    }\n  };\n\n  Map.prototype._scale = function _scale(e) {\n    var scale = this.scroller.movable.scale;\n\n    var zoom = this._scaleToZoom(scale);\n\n    var gestureCenter = new g.Point(e.center.x, e.center.y);\n    var centerLocation = this.viewToLocation(gestureCenter, zoom);\n    var centerPoint = this.locationToLayer(centerLocation, zoom);\n    var originPoint = centerPoint.translate(-gestureCenter.x, -gestureCenter.y);\n\n    this._zoomAround(originPoint, zoom);\n\n    this.trigger('zoomEnd', {\n      originalEvent: e\n    });\n  };\n\n  Map.prototype._scaleToZoom = function _scaleToZoom(scaleDelta) {\n    var scale = this._layerSize() * scaleDelta;\n    var tiles = scale / this.options.minSize;\n    var zoom = math.log(tiles) / math.log(2);\n    return math.round(zoom);\n  };\n\n  Map.prototype._reset = function _reset() {\n    if (this.attribution) {\n      this.attribution.filter(this.center(), this.zoom());\n    }\n\n    this._viewOrigin = this._getOrigin(true);\n\n    this._resetScroller();\n\n    this.hideTooltip();\n    this.trigger('beforeReset');\n    this.trigger('reset');\n  };\n\n  Map.prototype._resetScroller = function _resetScroller() {\n    var scroller = this.scroller;\n    var x = scroller.dimensions.x;\n    var y = scroller.dimensions.y;\n\n    var scale = this._layerSize();\n\n    var nw = this.extent().nw;\n    var topLeft = this.locationToLayer(nw).round();\n    scroller.movable.round = true;\n    scroller.reset();\n    scroller.userEvents.cancel();\n    var zoom = this.zoom();\n    scroller.dimensions.forcedMinScale = pow(2, this.options.minZoom - zoom);\n    scroller.dimensions.maxScale = pow(2, this.options.maxZoom - zoom);\n    var xBounds = {\n      min: -topLeft.x,\n      max: scale - topLeft.x\n    };\n    var yBounds = {\n      min: -topLeft.y,\n      max: scale - topLeft.y\n    };\n\n    if (this.options.wraparound) {\n      xBounds.max = 20 * scale;\n      xBounds.min = -xBounds.max;\n    }\n\n    if (this.options.pannable === false) {\n      var viewSize = this.viewSize();\n      xBounds.min = yBounds.min = 0;\n      xBounds.max = viewSize.width;\n      yBounds.max = viewSize.height;\n    }\n\n    x.makeVirtual();\n    y.makeVirtual();\n    x.virtualSize(xBounds.min, xBounds.max);\n    y.virtualSize(yBounds.min, yBounds.max);\n    this._virtualSize = {\n      x: xBounds,\n      y: yBounds\n    };\n  }; // kept for API compatibility, not used\n\n\n  Map.prototype._renderLayers = function _renderLayers() {};\n\n  Map.prototype._layerSize = function _layerSize(zoom) {\n    var newZoom = valueOrDefault(zoom, this.options.zoom);\n    return this.options.minSize * pow(2, newZoom);\n  };\n\n  Map.prototype._tap = function _tap(e) {\n    if (!this._panComplete()) {\n      return;\n    }\n\n    var cursor = this.eventOffset(e);\n    this.hideTooltip();\n    this.trigger('click', {\n      originalEvent: e,\n      location: this.viewToLocation(cursor)\n    });\n  };\n\n  Map.prototype._doubleTap = function _doubleTap(e) {\n    var options = this.options;\n\n    if (options.zoomable !== false) {\n      if (!this.trigger('zoomStart', {\n        originalEvent: e\n      })) {\n        var toZoom = this.zoom() + DEFAULT_ZOOM_RATE;\n        var cursor = this.eventOffset(e);\n        var location = this.viewToLocation(cursor);\n        var postZoom = this.locationToLayer(location, toZoom);\n        var origin = postZoom.translate(-cursor.x, -cursor.y);\n\n        this._zoomAround(origin, toZoom);\n\n        this.trigger('zoomEnd', {\n          originalEvent: e\n        });\n      }\n    }\n  };\n\n  Map.prototype._mousewheel = function _mousewheel(e) {\n    e.preventDefault();\n    var delta = mousewheelDelta(e) > 0 ? -1 : 1;\n    var options = this.options;\n    var fromZoom = this.zoom();\n    var toZoom = limitValue(fromZoom + delta, options.minZoom, options.maxZoom);\n\n    if (options.zoomable !== false && toZoom !== fromZoom) {\n      if (!this.trigger('zoomStart', {\n        originalEvent: e\n      })) {\n        var cursor = this.eventOffset(e);\n        var location = this.viewToLocation(cursor);\n        var postZoom = this.locationToLayer(location, toZoom);\n        var origin = postZoom.translate(-cursor.x, -cursor.y);\n\n        this._zoomAround(origin, toZoom);\n\n        this.trigger('zoomEnd', {\n          originalEvent: e\n        });\n      }\n    }\n  };\n\n  Map.prototype._toDocumentCoordinates = function _toDocumentCoordinates(point) {\n    var offset = elementOffset(this.element);\n    return {\n      left: round(point.x + offset.left),\n      top: round(point.y + offset.top)\n    };\n  };\n\n  return Map;\n}(Observable);\n\nsetDefaultOptions(Map, {\n  name: 'Map',\n  controls: {\n    attribution: true,\n    navigator: {\n      panStep: 100\n    },\n    zoom: true\n  },\n  layers: [],\n  layerDefaults: {\n    shape: {\n      style: {\n        fill: {\n          color: '#fff'\n        },\n        stroke: {\n          color: '#aaa',\n          width: 0.5\n        }\n      }\n    },\n    bubble: {\n      style: {\n        fill: {\n          color: '#fff',\n          opacity: 0.5\n        },\n        stroke: {\n          color: '#aaa',\n          width: 0.5\n        }\n      }\n    },\n    marker: {\n      shape: 'pinTarget',\n      tooltip: {\n        position: 'top'\n      }\n    }\n  },\n  center: [0, 0],\n  zoom: 3,\n  minSize: 256,\n  minZoom: 1,\n  maxZoom: 19,\n  markers: [],\n  markerDefaults: {\n    shape: 'pinTarget',\n    tooltip: {\n      position: 'top'\n    }\n  },\n  wraparound: true,\n  // If set to true, GeoJSON layer \"Point\" features will be rendered as markers.\n  // Otherwise, the points will be rendered as circles.\n  // Defaults to `true` for KUI/jQuery, `false` everywhere else.\n  renderPointsAsMarkers: false\n});\nsetDefaultEvents(Map, ['beforeReset', 'click', 'markerActivate', 'markerClick', 'markerCreated', // Events for implementing custom tooltips.\n'markerMouseEnter', 'markerMouseLeave', 'pan', 'panEnd', 'reset', 'shapeClick', 'shapeCreated', 'shapeFeatureCreated', 'shapeMouseEnter', 'shapeMouseLeave', 'zoomEnd', 'zoomStart']);\nexport default Map;","map":{"version":3,"sources":["C:/Users/nsahi/OneDrive/Documents/cyber_media/cm_galaxy/node_modules/@progress/kendo-charts/dist/es/map/map.js"],"names":["geometry","g","addClass","setDefaultOptions","valueOrDefault","defined","mousewheelDelta","limitValue","deepExtend","elementOffset","isArray","round","EPSG3857","Attribution","Navigator","ZoomControl","Location","Extent","Tooltip","TileLayer","BubbleLayer","ShapeLayer","MarkerLayer","removeChildren","setDefaultEvents","toHyphens","proxy","now","on","off","getSupportedFeatures","convertToHtml","Scroller","Observable","MapService","CENTER_CHANGE","INIT","ZOOM_CHANGE","math","Math","min","pow","Point","MARKER","LOCATION","FRICTION","FRICTION_MOBILE","MOUSEWHEEL","VELOCITY_MULTIPLIER","DEFAULT_ZOOM_RATE","layersMap","bubble","shape","tile","renderPos","pos","result","parts","split","i","length","push","join","Map","element","options","themeOptions","context","call","_init","__proto__","prototype","Object","create","constructor","destroy","this$1","scroller","_tooltip","navigator","attribution","zoomControl","markers","forEach","markerLayer","layers","_mousewheelHandler","support","initObserver","initServices","_notifyObserver","_initOptions","_setEvents","crs","_initElement","_viewOrigin","_getOrigin","_createTooltip","_initScroller","_initMarkers","_initControls","_initLayers","_reset","_mousewheel","bind","style","position","setAttribute","div","appendChild","widgetService","observers","addObserver","observer","removeObserver","index","indexOf","splice","requiresHandlers","eventNames","idx","trigger","name","args","sender","isDefaultPrevented","zoom","level","zoomLevel","minZoom","maxZoom","notify","center","center$1","current","previous","equals","toArray","extent","extent$1","_setExtent","_getExtent","setOptions","locationToLayer","location","clamp","wraparound","locationObject","toPoint","_layerSize","layerToLocation","point","pointObject","toLocation","locationToView","origin","translateWith","scale","viewToLocation","pointResult","clone","eventOffset","e","x","y","offset","left","top","event","originalEvent","pageX","clientX","pageY","clientY","eventToView","cursor","eventToLayer","eventToLocation","viewSize","width","clientWidth","height","clientHeight","exportVisual","hideTooltip","hide","_setOrigin","size","topLeft","originLocation","_origin","invalidate","newExtent","raw","se","lng","nw","bottomRight","layerWidth","abs","layerHeight","_zoomAround","pivot","controls","_createAttribution","mobileOS","_createNavigator","_createZoomControl","_createControlElement","defaultPosition","posSelector","replace","wrap","querySelector","div$1","document","createElement","_navigatorPan","_navigatorCenter","scrollLeft","scrollTop","bounds","_virtualSize","max","one","_scrollEnd","scrollTo","_zoomControlChange","delta","friction","zoomable","children","velocityMultiplier","mousewheelScrolling","supportDoubleTap","_scroll","userEvents","_scaleStart","_scale","_doubleTap","_tap","scrollElement","defs","layer","_createLayer","type","layerDefaults","layerOptions","markerDefaults","layerConstructor","tooltip","markerLayers","filter","add","movable","_scrollOffset","_panComplete","_panEndTimestamp","touch","touches","cancel","_scaleToZoom","gestureCenter","centerLocation","centerPoint","originPoint","translate","scaleDelta","tiles","minSize","log","_resetScroller","dimensions","reset","forcedMinScale","maxScale","xBounds","yBounds","pannable","makeVirtual","virtualSize","_renderLayers","newZoom","toZoom","postZoom","preventDefault","fromZoom","_toDocumentCoordinates","panStep","fill","color","stroke","opacity","marker","renderPointsAsMarkers"],"mappings":"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","sourcesContent":["import {\r\n    geometry as g\r\n} from '@progress/kendo-drawing';\r\n\r\nimport {\r\n    addClass,\r\n    setDefaultOptions,\r\n    valueOrDefault,\r\n    defined,\r\n    mousewheelDelta,\r\n    limitValue,\r\n    deepExtend,\r\n    elementOffset,\r\n    isArray,\r\n    round\r\n} from '../common';\r\n\r\nimport {\r\n    EPSG3857\r\n} from './crs';\r\n\r\nimport {\r\n    Attribution\r\n} from './attribution';\r\n\r\nimport {\r\n    Navigator\r\n} from './navigator';\r\n\r\nimport {\r\n    ZoomControl\r\n} from './zoom';\r\n\r\nimport {\r\n    Location\r\n} from './location';\r\n\r\nimport {\r\n    Extent\r\n} from './extent';\r\n\r\nimport { Tooltip } from './tooltip/tooltip';\r\n\r\nimport {\r\n    TileLayer\r\n} from './layers/tile';\r\n\r\nimport {\r\n    BubbleLayer\r\n} from './layers/bubble';\r\n\r\nimport {\r\n    ShapeLayer\r\n} from './layers/shape';\r\n\r\nimport {\r\n    MarkerLayer\r\n} from './layers/marker';\r\n\r\nimport {\r\n    removeChildren,\r\n    setDefaultEvents,\r\n    toHyphens,\r\n    proxy,\r\n    now,\r\n    on,\r\n    off,\r\n    getSupportedFeatures,\r\n    convertToHtml\r\n} from './utils';\r\n\r\nimport {\r\n    Scroller\r\n} from './scroller/scroller';\r\n\r\nimport {\r\n    Observable\r\n} from './scroller/observable';\r\n\r\nimport MapService from './../services/map-service';\r\n\r\nimport { CENTER_CHANGE, INIT, ZOOM_CHANGE } from './constants';\r\n\r\nvar math = Math,\r\n    min = math.min,\r\n    pow = math.pow,\r\n    Point = g.Point,\r\n    MARKER = \"marker\",\r\n    LOCATION = \"location\",\r\n    FRICTION = 0.9,\r\n    FRICTION_MOBILE = 0.93,\r\n    MOUSEWHEEL = 'DOMMouseScroll mousewheel',\r\n    VELOCITY_MULTIPLIER = 5,\r\n    DEFAULT_ZOOM_RATE = 1;\r\n\r\nvar layersMap = {\r\n    bubble: BubbleLayer,\r\n    shape: ShapeLayer,\r\n    tile: TileLayer\r\n};\r\nlayersMap[MARKER] = MarkerLayer;\r\n\r\nfunction renderPos(pos) {\r\n    var result = [];\r\n\r\n    if (pos) {\r\n        var parts = toHyphens(pos).split(\"-\");\r\n\r\n        for (var i = 0; i < parts.length; i++) {\r\n            result.push(\"k-pos-\" + parts[i]);\r\n        }\r\n    }\r\n\r\n    return result.join(\" \");\r\n}\r\n\r\nvar Map = (function (Observable) {\r\n    function Map(element, options, themeOptions, context) {\r\n        if ( options === void 0 ) options = {};\r\n        if ( themeOptions === void 0 ) themeOptions = {};\r\n        if ( context === void 0 ) context = {};\r\n\r\n        Observable.call(this);\r\n\r\n        this._init(element, options, themeOptions, context);\r\n    }\r\n\r\n    if ( Observable ) Map.__proto__ = Observable;\r\n    Map.prototype = Object.create( Observable && Observable.prototype );\r\n    Map.prototype.constructor = Map;\r\n\r\n    Map.prototype.destroy = function destroy () {\r\n        var this$1 = this;\r\n\r\n        this.scroller.destroy();\r\n\r\n        if (this._tooltip) {\r\n            this._tooltip.destroy();\r\n        }\r\n\r\n        if (this.navigator) {\r\n            this.navigator.destroy();\r\n        }\r\n        if (this.attribution) {\r\n            this.attribution.destroy();\r\n        }\r\n        if (this.zoomControl) {\r\n            this.zoomControl.destroy();\r\n        }\r\n\r\n        if (isArray(this.markers)) {\r\n            this.markers.forEach(function (markerLayer) {\r\n                markerLayer.destroy();\r\n            });\r\n        } else {\r\n            this.markers.destroy();\r\n        }\r\n\r\n        for (var i = 0; i < this.layers.length; i++) {\r\n            this$1.layers[i].destroy();\r\n        }\r\n\r\n        off(this.element, MOUSEWHEEL, this._mousewheelHandler);\r\n\r\n        Observable.prototype.destroy.call(this);\r\n    };\r\n\r\n    Map.prototype._init = function _init (element, options, themeOptions, context) {\r\n        if ( options === void 0 ) options = {};\r\n        if ( themeOptions === void 0 ) themeOptions = {};\r\n        if ( context === void 0 ) context = {};\r\n\r\n        this.support = getSupportedFeatures();\r\n        this.context = context;\r\n\r\n        this.initObserver(context);\r\n        this.initServices(context);\r\n        this._notifyObserver(INIT);\r\n\r\n        this._initOptions(options);\r\n        this._setEvents(options);\r\n        this.crs = new EPSG3857();\r\n\r\n        this._initElement(element);\r\n\r\n        this._viewOrigin = this._getOrigin();\r\n\r\n        this._tooltip = this._createTooltip();\r\n        this._initScroller();\r\n        this._initMarkers();\r\n        this._initControls();\r\n        this._initLayers();\r\n        this._reset();\r\n\r\n        this._mousewheelHandler = this._mousewheel.bind(this);\r\n        on(this.element, MOUSEWHEEL, this._mousewheelHandler);\r\n    };\r\n\r\n    Map.prototype._initOptions = function _initOptions (options) {\r\n        this.options = deepExtend({}, this.options, options);\r\n    };\r\n\r\n    Map.prototype._initElement = function _initElement (element) {\r\n        this.element = element;\r\n\r\n        addClass(element, \"k-map\");\r\n        element.style.position = \"relative\";\r\n        element.setAttribute(\"data-role\", \"map\");\r\n        removeChildren(element);\r\n\r\n        var div = convertToHtml(\"<div />\");\r\n        this.element.appendChild(div);\r\n    };\r\n\r\n    Map.prototype.initServices = function initServices (context) {\r\n        if ( context === void 0 ) context = {};\r\n\r\n        this.widgetService = new MapService(this, context);\r\n    };\r\n\r\n    Map.prototype.initObserver = function initObserver (context) {\r\n        if ( context === void 0 ) context = {};\r\n\r\n        this.observers = [];\r\n        this.addObserver(context.observer);\r\n    };\r\n\r\n    Map.prototype.addObserver = function addObserver (observer) {\r\n        if (observer) {\r\n            this.observers.push(observer);\r\n        }\r\n    };\r\n\r\n    Map.prototype.removeObserver = function removeObserver (observer) {\r\n        var index = this.observers.indexOf(observer);\r\n\r\n        if (index >= 0) {\r\n            this.observers.splice(index, 1);\r\n        }\r\n    };\r\n\r\n    Map.prototype.requiresHandlers = function requiresHandlers (eventNames) {\r\n        var observers = this.observers;\r\n\r\n        for (var idx = 0; idx < observers.length; idx++) {\r\n            if (observers[idx].requiresHandlers(eventNames)) {\r\n                return true;\r\n            }\r\n        }\r\n    };\r\n\r\n    Map.prototype.trigger = function trigger (name, args) {\r\n        if ( args === void 0 ) args = {};\r\n\r\n        args.sender = this;\r\n\r\n        var observers = this.observers;\r\n        var isDefaultPrevented = false;\r\n\r\n        for (var idx = 0; idx < observers.length; idx++) {\r\n            if (observers[idx].trigger(name, args)) {\r\n                isDefaultPrevented = true;\r\n            }\r\n        }\r\n\r\n        if (!isDefaultPrevented) {\r\n            Observable.prototype.trigger.call(this, name, args);\r\n        }\r\n\r\n        return isDefaultPrevented;\r\n    };\r\n\r\n    Map.prototype._notifyObserver = function _notifyObserver (name, args) {\r\n        if ( args === void 0 ) args = {};\r\n\r\n        args.sender = this;\r\n\r\n        var observers = this.observers;\r\n        var isDefaultPrevented = false;\r\n\r\n        for (var idx = 0; idx < observers.length; idx++) {\r\n            if (observers[idx].trigger(name, args)) {\r\n                isDefaultPrevented = true;\r\n            }\r\n        }\r\n\r\n        return isDefaultPrevented;\r\n    };\r\n\r\n    Map.prototype.zoom = function zoom (level) {\r\n        var options = this.options;\r\n        var result;\r\n\r\n        if (defined(level)) {\r\n            var zoomLevel = math.round(limitValue(level, options.minZoom, options.maxZoom));\r\n\r\n            if (options.zoom !== zoomLevel) {\r\n                options.zoom = zoomLevel;\r\n                this.widgetService.notify(ZOOM_CHANGE, { zoom: options.zoom });\r\n\r\n                this._reset();\r\n            }\r\n            result = this;\r\n        } else {\r\n            result = options.zoom;\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    Map.prototype.center = function center (center$1) {\r\n        var result;\r\n\r\n        if (center$1) {\r\n            var current = Location.create(center$1);\r\n            var previous = Location.create(this.options.center);\r\n            if (!current.equals(previous)) {\r\n                this.options.center = current.toArray();\r\n                this.widgetService.notify(CENTER_CHANGE, { center: this.options.center });\r\n                this._reset();\r\n            }\r\n\r\n            result = this;\r\n        } else {\r\n            result = Location.create(this.options.center);\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    Map.prototype.extent = function extent (extent$1) {\r\n        var result;\r\n\r\n        if (extent$1) {\r\n            this._setExtent(extent$1);\r\n            result = this;\r\n        } else {\r\n            result = this._getExtent();\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    Map.prototype.setOptions = function setOptions (options) {\r\n        if ( options === void 0 ) options = {};\r\n\r\n        var element = this.element;\r\n\r\n        this.destroy();\r\n        removeChildren(element);\r\n        this._init(element, options, {}, this.context);\r\n\r\n        this._reset();\r\n    };\r\n\r\n    Map.prototype.locationToLayer = function locationToLayer (location, zoom) {\r\n        var clamp = !this.options.wraparound;\r\n        var locationObject = Location.create(location);\r\n\r\n        return this.crs.toPoint(locationObject, this._layerSize(zoom), clamp);\r\n    };\r\n\r\n    Map.prototype.layerToLocation = function layerToLocation (point, zoom) {\r\n        var clamp = !this.options.wraparound;\r\n        var pointObject = Point.create(point);\r\n\r\n        return this.crs.toLocation(pointObject, this._layerSize(zoom), clamp);\r\n    };\r\n\r\n    Map.prototype.locationToView = function locationToView (location) {\r\n        var locationObject = Location.create(location);\r\n        var origin = this.locationToLayer(this._viewOrigin);\r\n        var point = this.locationToLayer(locationObject);\r\n\r\n        return point.translateWith(origin.scale(-1));\r\n    };\r\n\r\n    Map.prototype.viewToLocation = function viewToLocation (point, zoom) {\r\n        var origin = this.locationToLayer(this._getOrigin(), zoom);\r\n        var pointObject = Point.create(point);\r\n        var pointResult = pointObject.clone().translateWith(origin);\r\n\r\n        return this.layerToLocation(pointResult, zoom);\r\n    };\r\n\r\n    Map.prototype.eventOffset = function eventOffset (e) {\r\n        var x;\r\n        var y;\r\n        var offset = elementOffset(this.element);\r\n\r\n        if ((e.x && e.x[LOCATION]) || (e.y && e.y[LOCATION])) {\r\n            x = e.x[LOCATION] - offset.left;\r\n            y = e.y[LOCATION] - offset.top;\r\n        } else {\r\n            var event = e.originalEvent || e;\r\n            x = valueOrDefault(event.pageX, event.clientX) - offset.left;\r\n            y = valueOrDefault(event.pageY, event.clientY) - offset.top;\r\n        }\r\n\r\n        var point = new g.Point(x, y);\r\n\r\n        return point;\r\n    };\r\n\r\n    Map.prototype.eventToView = function eventToView (e) {\r\n        var cursor = this.eventOffset(e);\r\n        return this.locationToView(this.viewToLocation(cursor));\r\n    };\r\n\r\n    Map.prototype.eventToLayer = function eventToLayer (e) {\r\n        return this.locationToLayer(this.eventToLocation(e));\r\n    };\r\n\r\n    Map.prototype.eventToLocation = function eventToLocation (e) {\r\n        var cursor = this.eventOffset(e);\r\n        return this.viewToLocation(cursor);\r\n    };\r\n\r\n    Map.prototype.viewSize = function viewSize () {\r\n        var element = this.element;\r\n        var scale = this._layerSize();\r\n        var width = element.clientWidth;\r\n\r\n        if (!this.options.wraparound) {\r\n            width = min(scale, width);\r\n        }\r\n\r\n        return {\r\n            width: width,\r\n            height: min(scale, element.clientHeight)\r\n        };\r\n    };\r\n\r\n    Map.prototype.exportVisual = function exportVisual () {\r\n        this._reset();\r\n        return false;\r\n    };\r\n\r\n    Map.prototype.hideTooltip = function hideTooltip () {\r\n        if (this._tooltip) {\r\n            this._tooltip.hide();\r\n        }\r\n    };\r\n\r\n    Map.prototype._setOrigin = function _setOrigin (origin, zoom) {\r\n        var size = this.viewSize(),\r\n            topLeft;\r\n\r\n        var originLocation = this._origin = Location.create(origin);\r\n        topLeft = this.locationToLayer(originLocation, zoom);\r\n        topLeft.x += size.width / 2;\r\n        topLeft.y += size.height / 2;\r\n        this.options.center = this.layerToLocation(topLeft, zoom).toArray();\r\n        this.widgetService.notify(CENTER_CHANGE, { center: this.options.center });\r\n\r\n        return this;\r\n    };\r\n\r\n    Map.prototype._getOrigin = function _getOrigin (invalidate) {\r\n        var size = this.viewSize(),\r\n            topLeft;\r\n\r\n        if (invalidate || !this._origin) {\r\n            topLeft = this.locationToLayer(this.center());\r\n            topLeft.x -= size.width / 2;\r\n            topLeft.y -= size.height / 2;\r\n            this._origin = this.layerToLocation(topLeft);\r\n        }\r\n\r\n        return this._origin;\r\n    };\r\n\r\n    Map.prototype._setExtent = function _setExtent (newExtent) {\r\n        var this$1 = this;\r\n\r\n        var raw = Extent.create(newExtent);\r\n        var se = raw.se.clone();\r\n\r\n        if (this.options.wraparound && se.lng < 0 && newExtent.nw.lng > 0) {\r\n            se.lng = 180 + (180 + se.lng);\r\n        }\r\n\r\n        var extent = new Extent(raw.nw, se);\r\n        this.center(extent.center());\r\n        var width = this.element.clientWidth;\r\n        var height = this.element.clientHeight;\r\n        var zoom;\r\n\r\n        for (zoom = this.options.maxZoom; zoom >= this.options.minZoom; zoom--) {\r\n            var topLeft = this$1.locationToLayer(extent.nw, zoom);\r\n            var bottomRight = this$1.locationToLayer(extent.se, zoom);\r\n            var layerWidth = math.abs(bottomRight.x - topLeft.x);\r\n            var layerHeight = math.abs(bottomRight.y - topLeft.y);\r\n\r\n            if (layerWidth <= width && layerHeight <= height) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.zoom(zoom);\r\n    };\r\n\r\n    Map.prototype._getExtent = function _getExtent () {\r\n        var nw = this._getOrigin();\r\n        var bottomRight = this.locationToLayer(nw);\r\n        var size = this.viewSize();\r\n\r\n        bottomRight.x += size.width;\r\n        bottomRight.y += size.height;\r\n\r\n        var se = this.layerToLocation(bottomRight);\r\n\r\n        return new Extent(nw, se);\r\n    };\r\n\r\n    Map.prototype._zoomAround = function _zoomAround (pivot, level) {\r\n        this._setOrigin(this.layerToLocation(pivot, level), level);\r\n        this.zoom(level);\r\n    };\r\n\r\n    Map.prototype._initControls = function _initControls () {\r\n        var controls = this.options.controls;\r\n        if (controls.attribution) {\r\n            this._createAttribution(controls.attribution);\r\n        }\r\n\r\n        if (!this.support.mobileOS) {\r\n            if (controls.navigator) {\r\n                this._createNavigator(controls.navigator);\r\n            }\r\n\r\n            if (controls.zoom) {\r\n                this._createZoomControl(controls.zoom);\r\n            }\r\n        }\r\n    };\r\n\r\n    Map.prototype._createControlElement = function _createControlElement (options, defaultPosition) {\r\n        var pos = options.position || defaultPosition;\r\n        var posSelector = '.' + renderPos(pos).replace(' ', '.');\r\n        var wrap = this.element.querySelector('.k-map-controls' + posSelector) || [];\r\n\r\n        if (wrap.length === 0) {\r\n            var div$1 = document.createElement(\"div\");\r\n            addClass(div$1, 'k-map-controls ' + renderPos(pos));\r\n            wrap = div$1;\r\n            this.element.appendChild(wrap);\r\n        }\r\n\r\n        var div = document.createElement(\"div\");\r\n\r\n        wrap.appendChild(div);\r\n\r\n        return div;\r\n    };\r\n\r\n    Map.prototype._createAttribution = function _createAttribution (options) {\r\n        var element = this._createControlElement(options, 'bottomRight');\r\n        this.attribution = new Attribution(element, options);\r\n    };\r\n\r\n    Map.prototype._createNavigator = function _createNavigator (options) {\r\n        var element = this._createControlElement(options, 'topLeft');\r\n        var navigator = this.navigator = new Navigator(element, options);\r\n\r\n        this._navigatorPan = this._navigatorPan.bind(this);\r\n        navigator.bind('pan', this._navigatorPan);\r\n\r\n        this._navigatorCenter = this._navigatorCenter.bind(this);\r\n        navigator.bind('center', this._navigatorCenter);\r\n    };\r\n\r\n    Map.prototype._navigatorPan = function _navigatorPan (e) {\r\n        var scroller = this.scroller;\r\n        var x = scroller.scrollLeft + e.x;\r\n        var y = scroller.scrollTop - e.y;\r\n        var bounds = this._virtualSize;\r\n        var width = this.element.clientWidth;\r\n        var height = this.element.clientHeight;\r\n\r\n        // TODO: Move limits to scroller\r\n        x = limitValue(x, bounds.x.min, bounds.x.max - width);\r\n        y = limitValue(y, bounds.y.min, bounds.y.max - height);\r\n\r\n        this.scroller.one('scroll', proxy(this._scrollEnd, this));\r\n\r\n        this.scroller.scrollTo(-x, -y);\r\n    };\r\n\r\n    Map.prototype._navigatorCenter = function _navigatorCenter () {\r\n        this.center(this.options.center);\r\n    };\r\n\r\n    Map.prototype._createZoomControl = function _createZoomControl (options) {\r\n        var element = this._createControlElement(options, 'topLeft');\r\n        var zoomControl = this.zoomControl = new ZoomControl(element, options);\r\n\r\n        this._zoomControlChange = this._zoomControlChange.bind(this);\r\n        zoomControl.bind('change', this._zoomControlChange);\r\n    };\r\n\r\n    Map.prototype._zoomControlChange = function _zoomControlChange (e) {\r\n        if (!this.trigger('zoomStart', { originalEvent: e })) {\r\n            this.zoom(this.zoom() + e.delta);\r\n\r\n            this.trigger('zoomEnd', {\r\n                originalEvent: e\r\n            });\r\n        }\r\n    };\r\n\r\n    Map.prototype._initScroller = function _initScroller () {\r\n        var friction = this.support.mobileOS ? FRICTION_MOBILE : FRICTION;\r\n        var zoomable = this.options.zoomable !== false;\r\n        var scroller = this.scroller = new Scroller(this.element.children[0], {\r\n            friction: friction,\r\n            velocityMultiplier: VELOCITY_MULTIPLIER,\r\n            zoom: zoomable,\r\n            mousewheelScrolling: false,\r\n            supportDoubleTap: true\r\n        });\r\n\r\n        scroller.bind('scroll', proxy(this._scroll, this));\r\n        scroller.bind('scrollEnd', proxy(this._scrollEnd, this));\r\n\r\n        scroller.userEvents.bind('gesturestart', proxy(this._scaleStart, this));\r\n        scroller.userEvents.bind('gestureend', proxy(this._scale, this));\r\n        scroller.userEvents.bind('doubleTap', proxy(this._doubleTap, this));\r\n        scroller.userEvents.bind('tap', proxy(this._tap, this));\r\n\r\n        this.scrollElement = scroller.scrollElement;\r\n    };\r\n\r\n    Map.prototype._initLayers = function _initLayers () {\r\n        var this$1 = this;\r\n\r\n        var defs = this.options.layers,\r\n            layers = this.layers = [];\r\n\r\n        for (var i = 0; i < defs.length; i++) {\r\n            var options = defs[i];\r\n\r\n            var layer = this$1._createLayer(options);\r\n            layers.push(layer);\r\n        }\r\n    };\r\n\r\n    Map.prototype._createLayer = function _createLayer (options) {\r\n        var type = options.type || 'shape';\r\n        var layerDefaults = this.options.layerDefaults[type];\r\n        var layerOptions = type === MARKER ?\r\n            deepExtend({}, this.options.markerDefaults, options) :\r\n            deepExtend({}, layerDefaults, options);\r\n\r\n        var layerConstructor = layersMap[type];\r\n        var layer = new layerConstructor(this, layerOptions);\r\n\r\n        if (type === MARKER) {\r\n            this.markers = layer;\r\n        }\r\n\r\n        return layer;\r\n    };\r\n\r\n    Map.prototype._createTooltip = function _createTooltip () {\r\n        return new Tooltip(this.widgetService, this.options.tooltip);\r\n    };\r\n\r\n    /* eslint-disable arrow-body-style */\r\n    Map.prototype._initMarkers = function _initMarkers () {\r\n        var markerLayers = (this.options.layers || []).filter(function (x) {\r\n            return x && x.type === MARKER;\r\n        });\r\n\r\n        if (markerLayers.length > 0) {\r\n            // render the markers from options.layers\r\n            // instead of options.markers\r\n            return;\r\n        }\r\n\r\n        this.markers = new MarkerLayer(this, this.options.markerDefaults);\r\n        this.markers.add(this.options.markers);\r\n    };\r\n    /* eslint-enable arrow-body-style */\r\n\r\n    Map.prototype._scroll = function _scroll (e) {\r\n        var origin = this.locationToLayer(this._viewOrigin).round();\r\n        var movable = e.sender.movable;\r\n        var offset = new g.Point(movable.x, movable.y).scale(-1).scale(1 / movable.scale);\r\n\r\n        origin.x += offset.x;\r\n        origin.y += offset.y;\r\n        this._scrollOffset = offset;\r\n\r\n        this._tooltip.offset = offset;\r\n        this.hideTooltip();\r\n\r\n        this._setOrigin(this.layerToLocation(origin));\r\n\r\n        this.trigger('pan', {\r\n            originalEvent: e,\r\n            origin: this._getOrigin(),\r\n            center: this.center()\r\n        });\r\n    };\r\n\r\n    Map.prototype._scrollEnd = function _scrollEnd (e) {\r\n        if (!this._scrollOffset || !this._panComplete()) {\r\n            return;\r\n        }\r\n\r\n        this._scrollOffset = null;\r\n        this._panEndTimestamp = now();\r\n\r\n        this.trigger('panEnd', {\r\n            originalEvent: e,\r\n            origin: this._getOrigin(),\r\n            center: this.center()\r\n        });\r\n    };\r\n\r\n    Map.prototype._panComplete = function _panComplete () {\r\n        return now() - (this._panEndTimestamp || 0) > 50;\r\n    };\r\n\r\n    Map.prototype._scaleStart = function _scaleStart (e) {\r\n        if (this.trigger('zoomStart', { originalEvent: e })) {\r\n            var touch = e.touches[1];\r\n\r\n            if (touch) {\r\n                touch.cancel();\r\n            }\r\n        }\r\n    };\r\n\r\n    Map.prototype._scale = function _scale (e) {\r\n        var scale = this.scroller.movable.scale;\r\n        var zoom = this._scaleToZoom(scale);\r\n        var gestureCenter = new g.Point(e.center.x, e.center.y);\r\n        var centerLocation = this.viewToLocation(gestureCenter, zoom);\r\n        var centerPoint = this.locationToLayer(centerLocation, zoom);\r\n        var originPoint = centerPoint.translate(-gestureCenter.x, -gestureCenter.y);\r\n\r\n        this._zoomAround(originPoint, zoom);\r\n\r\n        this.trigger('zoomEnd', {\r\n            originalEvent: e\r\n        });\r\n    };\r\n\r\n    Map.prototype._scaleToZoom = function _scaleToZoom (scaleDelta) {\r\n        var scale = this._layerSize() * scaleDelta;\r\n        var tiles = scale / this.options.minSize;\r\n        var zoom = math.log(tiles) / math.log(2);\r\n\r\n        return math.round(zoom);\r\n    };\r\n\r\n    Map.prototype._reset = function _reset () {\r\n        if (this.attribution) {\r\n            this.attribution.filter(this.center(), this.zoom());\r\n        }\r\n\r\n        this._viewOrigin = this._getOrigin(true);\r\n\r\n        this._resetScroller();\r\n        this.hideTooltip();\r\n\r\n        this.trigger('beforeReset');\r\n        this.trigger('reset');\r\n    };\r\n\r\n    Map.prototype._resetScroller = function _resetScroller () {\r\n        var scroller = this.scroller;\r\n        var x = scroller.dimensions.x;\r\n        var y = scroller.dimensions.y;\r\n        var scale = this._layerSize();\r\n        var nw = this.extent().nw;\r\n        var topLeft = this.locationToLayer(nw).round();\r\n\r\n        scroller.movable.round = true;\r\n        scroller.reset();\r\n        scroller.userEvents.cancel();\r\n\r\n        var zoom = this.zoom();\r\n\r\n        scroller.dimensions.forcedMinScale = pow(2, this.options.minZoom - zoom);\r\n        scroller.dimensions.maxScale = pow(2, this.options.maxZoom - zoom);\r\n\r\n        var xBounds = {\r\n            min: -topLeft.x,\r\n            max: scale - topLeft.x\r\n        };\r\n\r\n        var yBounds = {\r\n            min: -topLeft.y,\r\n            max: scale - topLeft.y\r\n        };\r\n\r\n        if (this.options.wraparound) {\r\n            xBounds.max = 20 * scale;\r\n            xBounds.min = -xBounds.max;\r\n        }\r\n\r\n        if (this.options.pannable === false) {\r\n            var viewSize = this.viewSize();\r\n            xBounds.min = yBounds.min = 0;\r\n            xBounds.max = viewSize.width;\r\n            yBounds.max = viewSize.height;\r\n        }\r\n\r\n        x.makeVirtual();\r\n        y.makeVirtual();\r\n\r\n        x.virtualSize(xBounds.min, xBounds.max);\r\n        y.virtualSize(yBounds.min, yBounds.max);\r\n\r\n        this._virtualSize = {\r\n            x: xBounds,\r\n            y: yBounds\r\n        };\r\n    };\r\n\r\n    // kept for API compatibility, not used\r\n    Map.prototype._renderLayers = function _renderLayers () {\r\n    };\r\n\r\n    Map.prototype._layerSize = function _layerSize (zoom) {\r\n        var newZoom = valueOrDefault(zoom, this.options.zoom);\r\n        return this.options.minSize * pow(2, newZoom);\r\n    };\r\n\r\n    Map.prototype._tap = function _tap (e) {\r\n        if (!this._panComplete()) {\r\n            return;\r\n        }\r\n\r\n        var cursor = this.eventOffset(e);\r\n        this.hideTooltip();\r\n\r\n        this.trigger('click', {\r\n            originalEvent: e,\r\n            location: this.viewToLocation(cursor)\r\n        });\r\n    };\r\n\r\n    Map.prototype._doubleTap = function _doubleTap (e) {\r\n        var options = this.options;\r\n\r\n        if (options.zoomable !== false) {\r\n            if (!this.trigger('zoomStart', { originalEvent: e })) {\r\n                var toZoom = this.zoom() + DEFAULT_ZOOM_RATE;\r\n                var cursor = this.eventOffset(e);\r\n                var location = this.viewToLocation(cursor);\r\n                var postZoom = this.locationToLayer(location, toZoom);\r\n                var origin = postZoom.translate(-cursor.x, -cursor.y);\r\n\r\n                this._zoomAround(origin, toZoom);\r\n\r\n                this.trigger('zoomEnd', {\r\n                    originalEvent: e\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    Map.prototype._mousewheel = function _mousewheel (e) {\r\n        e.preventDefault();\r\n        var delta = mousewheelDelta(e) > 0 ? -1 : 1;\r\n        var options = this.options;\r\n        var fromZoom = this.zoom();\r\n        var toZoom = limitValue(fromZoom + delta, options.minZoom, options.maxZoom);\r\n\r\n        if (options.zoomable !== false && toZoom !== fromZoom) {\r\n            if (!this.trigger('zoomStart', { originalEvent: e })) {\r\n                var cursor = this.eventOffset(e);\r\n                var location = this.viewToLocation(cursor);\r\n                var postZoom = this.locationToLayer(location, toZoom);\r\n                var origin = postZoom.translate(-cursor.x, -cursor.y);\r\n\r\n                this._zoomAround(origin, toZoom);\r\n\r\n                this.trigger('zoomEnd', {\r\n                    originalEvent: e\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    Map.prototype._toDocumentCoordinates = function _toDocumentCoordinates (point) {\r\n        var offset = elementOffset(this.element);\r\n\r\n        return {\r\n            left: round(point.x + offset.left),\r\n            top: round(point.y + offset.top)\r\n        };\r\n    };\r\n\r\n    return Map;\r\n}(Observable));\r\n\r\nsetDefaultOptions(Map, {\r\n    name: 'Map',\r\n    controls: {\r\n        attribution: true,\r\n        navigator: {\r\n            panStep: 100\r\n        },\r\n        zoom: true\r\n    },\r\n    layers: [],\r\n    layerDefaults: {\r\n        shape: {\r\n            style: {\r\n                fill: {\r\n                    color: '#fff'\r\n                },\r\n                stroke: {\r\n                    color: '#aaa',\r\n                    width: 0.5\r\n                }\r\n            }\r\n        },\r\n        bubble: {\r\n            style: {\r\n                fill: {\r\n                    color: '#fff',\r\n                    opacity: 0.5\r\n                },\r\n                stroke: {\r\n                    color: '#aaa',\r\n                    width: 0.5\r\n                }\r\n            }\r\n        },\r\n        marker: {\r\n            shape: 'pinTarget',\r\n            tooltip: {\r\n                position: 'top'\r\n            }\r\n        }\r\n    },\r\n    center: [\r\n        0,\r\n        0\r\n    ],\r\n    zoom: 3,\r\n    minSize: 256,\r\n    minZoom: 1,\r\n    maxZoom: 19,\r\n    markers: [],\r\n    markerDefaults: {\r\n        shape: 'pinTarget',\r\n        tooltip: {\r\n            position: 'top'\r\n        }\r\n    },\r\n    wraparound: true,\r\n    // If set to true, GeoJSON layer \"Point\" features will be rendered as markers.\r\n    // Otherwise, the points will be rendered as circles.\r\n    // Defaults to `true` for KUI/jQuery, `false` everywhere else.\r\n    renderPointsAsMarkers: false\r\n});\r\n\r\nsetDefaultEvents(Map, [\r\n    'beforeReset',\r\n    'click',\r\n    'markerActivate',\r\n    'markerClick',\r\n    'markerCreated',\r\n\r\n    // Events for implementing custom tooltips.\r\n    'markerMouseEnter',\r\n    'markerMouseLeave',\r\n\r\n    'pan',\r\n    'panEnd',\r\n    'reset',\r\n    'shapeClick',\r\n    'shapeCreated',\r\n    'shapeFeatureCreated',\r\n    'shapeMouseEnter',\r\n    'shapeMouseLeave',\r\n    'zoomEnd',\r\n    'zoomStart'\r\n]);\r\n\r\nexport default Map;\r\n"]},"metadata":{},"sourceType":"module"}